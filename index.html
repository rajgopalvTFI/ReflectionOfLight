<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Reflection of Light - Quiz</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #f5f7ff;
      --card-bg: #ffffff;
      --accent: #3b82f6;
      --accent-soft: #dbeafe;
      --accent-dark: #1d4ed8;
      --text-main: #111827;
      --text-muted: #4b5563;
      --border-subtle: #e5e7eb;
      --correct: #22c55e;
      --incorrect: #ef4444;
      --warning: #f97316;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
      background: radial-gradient(circle at top, #e0f2fe 0, #f5f7ff 40%, #f9fafb 100%);
      color: var(--text-main);
    }

    .page {
      max-width: 1100px;
      margin: 0 auto;
      padding: 1.5rem 1.25rem 3rem;
    }

    header.hero {
      background: linear-gradient(135deg, #1d4ed8, #4f46e5);
      color: white;
      border-radius: 1.5rem;
      padding: 1.75rem 1.75rem 1.5rem;
      box-shadow: 0 20px 40px rgba(15, 23, 42, 0.35);
      position: relative;
      overflow: hidden;
      margin-bottom: 1.75rem;
    }

    header.hero::after {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at 10% 0, rgba(255, 255, 255, 0.18), transparent 55%),
                  radial-gradient(circle at 90% 80%, rgba(59, 130, 246, 0.35), transparent 60%);
      mix-blend-mode: screen;
      pointer-events: none;
    }

    .hero-content {
      position: relative;
      z-index: 1;
      display: flex;
      flex-wrap: wrap;
      gap: 1rem 2rem;
      align-items: center;
      justify-content: space-between;
    }

    .hero-text h1 {
      margin: 0 0 0.5rem;
      font-size: clamp(1.9rem, 3vw, 2.2rem);
      letter-spacing: 0.03em;
    }

    .hero-text p {
      margin: 0.15rem 0;
      font-size: 0.98rem;
      opacity: 0.95;
    }

    .hero-badges {
      display: flex;
      flex-direction: column;
      gap: 0.4rem;
      font-size: 0.85rem;
      align-items: flex-end;
    }

    .badge {
      padding: 0.25rem 0.7rem;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.3);
      border: 1px solid rgba(191, 219, 254, 0.6);
      backdrop-filter: blur(6px);
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
    }

    .badge span.icon {
      font-size: 1rem;
    }

    .section {
      margin-bottom: 2rem;
    }

    .section h2 {
      font-size: 1.2rem;
      margin: 0 0 0.75rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .section h2 span.tagline {
      font-size: 0.8rem;
      color: var(--text-muted);
      font-weight: 400;
    }

    .muted {
      color: var(--text-muted);
      font-size: 0.95rem;
      line-height: 1.5;
    }

    /* Big overview / mental map */

    .overview-layout {
      display: grid;
      grid-template-columns: minmax(0, 1.7fr) minmax(0, 1.3fr);
      gap: 1.5rem;
      align-items: flex-start;
    }

    @media (max-width: 880px) {
      .overview-layout {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .card {
      background: var(--card-bg);
      border-radius: 1.25rem;
      padding: 1.25rem 1.3rem;
      box-shadow: 0 12px 30px rgba(15, 23, 42, 0.08);
      border: 1px solid rgba(209, 213, 219, 0.7);
    }

    .card h3 {
      margin: 0 0 0.7rem;
      font-size: 1rem;
    }

    /* Section cards */

    .section-grid {
      display: grid;
      grid-template-columns: repeat(3, minmax(220px, 1fr)); /* 3 per row on desktop */
      gap: 1.5rem 1.5rem;
      width: 100%;
    }

    .section-card {
      border-radius: 1rem;
      padding: 1rem;
      background: linear-gradient(135deg, #ffffff, #eff6ff);
      border: 1px solid #dbeafe;
      box-shadow: 0 10px 24px rgba(15, 23, 42, 0.05);
      display: flex;
      flex-direction: column;
      gap: 0.6rem;
      position: relative;
      overflow: hidden;
      width: 100%;
    }

    .section-card h3 {
      margin: 0;
      font-size: 1rem;
      display: flex;
      align-items: center;
      gap: 0.45rem;
    }

    .section-chip {
      font-size: 0.75rem;
      padding: 0.1rem 0.45rem;
      border-radius: 999px;
      background: rgba(37, 99, 235, 0.08);
      border: 1px solid rgba(191, 219, 254, 0.8);
      color: var(--accent-dark);
    }

    .section-card p {
      margin: 0;
      font-size: 0.86rem;
      color: var(--text-muted);
    }

    .section-actions {
      margin-top: 0.4rem;
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
    }

    .btn {
      border-radius: 999px;
      border: none;
      padding: 0.35rem 0.9rem;
      font-size: 0.85rem;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 0.45rem;
      font-weight: 500;
      transition: transform 0.08s ease, box-shadow 0.08s ease, background 0.12s ease;
      white-space: nowrap;
    }

    .btn-primary {
      background: var(--accent);
      color: white;
      box-shadow: 0 6px 16px rgba(37, 99, 235, 0.35);
    }

    .btn-primary:hover {
      transform: translateY(-1px);
      box-shadow: 0 10px 22px rgba(37, 99, 235, 0.5);
      background: var(--accent-dark);
    }

    .btn-outline {
      background: white;
      border: 1px solid #cbd5f5;
      color: var(--accent-dark);
    }

    .btn-outline:hover {
      background: #eff6ff;
      transform: translateY(-1px);
    }

    /* Section overview (mental map by section) */

    .section-overview {
      margin-top: 1.2rem;
    }

    .section-overview h3 {
      margin-top: 0;
      font-size: 1rem;
    }

    .section-overview-block {
      margin-bottom: 1.1rem;
      padding: 0.8rem 0.9rem;
      border-radius: 0.9rem;
      border: 1px dashed #cbd5f5;
      background: #f9fafb;
    }

    .section-overview-block strong {
      display: inline-block;
      margin-bottom: 0.35rem;
    }

    .section-overview-arrows {
      font-size: 0.92rem;
      line-height: 1.6;
      color: var(--text-muted);
    }

    /* Responsive layout for section cards */

    @media (max-width: 992px) {
      .section-grid {
        grid-template-columns: repeat(2, minmax(200px, 1fr));
      }
    }

    @media (max-width: 600px) {
      .section-grid {
        grid-template-columns: 1fr;   /* ONE card per row on mobiles */
        gap: 1.25rem;
      }

      .section-card {
        padding: 1.1rem 1.25rem;
        margin: 0;
      }
    }

    /* Nice step layout for Formulas & Calculations overview */

    .flow-steps {
      list-style: none;
      padding: 0;
      margin: 0;
      display: flex;
      flex-direction: column;
      gap: 0.9rem;
      font-size: 0.9rem;
      color: var(--text-muted);
    }

    .flow-step {
      position: relative;
      padding-left: 1.8rem;
    }

    .flow-step::before {
      content: attr(data-step);
      position: absolute;
      left: 0;
      top: 0.1rem;
      width: 1.3rem;
      height: 1.3rem;
      border-radius: 50%;
      background: var(--accent-soft);
      border: 1px solid #bfdbfe;
      color: var(--accent-dark);
      font-size: 0.75rem;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
    }

    .flow-step-title {
      font-weight: 600;
      color: var(--text-main);
      margin-bottom: 0.2rem;
    }

    .flow-step-body {
      font-size: 0.88rem;
    }

    .flow-subpoints {
      margin: 0.2rem 0 0;
      padding-left: 1.1rem;
      font-size: 0.86rem;
    }

    /* Quiz area */

    #quiz-area {
      margin-top: 1.8rem;
    }

    #quiz-container {
      margin-top: 0.7rem;
      display: none;
    }

    #quiz-container.active {
      display: block;
    }

    .quiz-header {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      align-items: center;
      gap: 0.75rem;
      margin-bottom: 0.6rem;
    }

    .quiz-header-title {
      font-weight: 600;
      font-size: 0.98rem;
      display: flex;
      flex-wrap: wrap;
      gap: 0.4rem;
      align-items: center;
    }

    .quiz-header-title span.section-name {
      color: var(--accent-dark);
    }

    .quiz-header-title small {
      font-weight: 400;
      color: var(--text-muted);
      font-size: 0.8rem;
    }

    .toggle-map-btn {
      padding: 0.3rem 0.75rem;
      font-size: 0.8rem;
      border-radius: 999px;
      border: 1px dashed #bfdbfe;
      background: #eff6ff;
      color: var(--accent-dark);
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
    }

    .toggle-map-btn span.icon {
      font-size: 0.9rem;
    }

    .quiz-layout {
      display: grid;
      grid-template-columns: minmax(0, 2.1fr) minmax(0, 1.3fr);
      gap: 1rem;
      align-items: flex-start;
    }

    @media (max-width: 900px) {
      .quiz-layout {
        grid-template-columns: minmax(0, 1fr);
      }
      #section-map-panel {
        order: -1;
      }
    }

    .quiz-card {
      background: var(--card-bg);
      border-radius: 1rem;
      padding: 1rem;
      border: 1px solid #e5e7eb;
      box-shadow: 0 8px 20px rgba(15, 23, 42, 0.06);
    }

    .progress-bar-wrapper {
      height: 0.55rem;
      border-radius: 999px;
      background: #e5e7eb;
      overflow: hidden;
      margin-bottom: 0.7rem;
    }

    .progress-bar-fill {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, #22c55e, #3b82f6);
      transition: width 0.25s ease;
    }

    .quiz-status-line {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      margin-bottom: 0.4rem;
      font-size: 0.83rem;
      color: var(--text-muted);
    }

    .quiz-question-text {
      font-size: 0.98rem;
      margin-bottom: 0.75rem;
      font-weight: 500;
    }

    .options-list {
      list-style: none;
      padding: 0;
      margin: 0.3rem 0 0.6rem;
      display: flex;
      flex-direction: column;
      gap: 0.45rem;
    }

    .option-item {
      border-radius: 0.65rem;
      border: 1px solid #e5e7eb;
      padding: 0.4rem 0.55rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      cursor: pointer;
      transition: border 0.12s ease, background 0.12s ease, transform 0.05s ease;
      background: #f9fafb;
    }

    .option-item:hover {
      border-color: #bfdbfe;
      background: #eff6ff;
      transform: translateY(-1px);
    }

    .option-item input {
      margin: 0;
      accent-color: var(--accent);
    }

    .option-letter {
      font-weight: 600;
      font-size: 0.84rem;
      color: var(--text-muted);
      width: 1.1rem;
      text-align: center;
    }

    .option-text {
      font-size: 0.9rem;
    }

    .option-item.selected {
      border-color: var(--accent);
      background: #e0ecff;
    }

    .quiz-nav {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 0.7rem;
      gap: 0.5rem;
      flex-wrap: wrap;
    }

    .quiz-nav-left {
      display: flex;
      gap: 0.4rem;
      flex-wrap: wrap;
    }

    .quiz-nav-right {
      margin-left: auto;
    }

    .btn-small {
      padding: 0.32rem 0.7rem;
      font-size: 0.8rem;
    }

    .btn-ghost {
      background: transparent;
      border: none;
      color: var(--text-muted);
      cursor: pointer;
      font-size: 0.8rem;
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
    }

    .btn-ghost:hover {
      color: var(--accent-dark);
    }

    #section-map-panel {
      border-radius: 1rem;
      border: 1px dashed #cbd5f5;
      background: #eff6ff;
      padding: 0.8rem 0.9rem;
      font-size: 0.86rem;
      display: none;
    }

    #section-map-panel.active {
      display: block;
    }

    #section-map-panel h4 {
      margin: 0 0 0.3rem;
      font-size: 0.9rem;
      color: var(--accent-dark);
    }

    #section-map-panel ul {
      margin: 0.3rem 0 0;
      padding-left: 1.1rem;
    }

    #section-map-panel li {
      margin-bottom: 0.3rem;
    }

    /* Results */

    #results-card {
      display: none;
      margin-top: 1rem;
    }

    #results-card.active {
      display: block;
    }

    .results-header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      gap: 0.6rem;
      flex-wrap: wrap;
    }

    .results-score {
      font-weight: 600;
      font-size: 0.95rem;
    }

    .results-score span.good {
      color: var(--correct);
    }

    .results-score span.bad {
      color: var(--incorrect);
    }

    .results-summary {
      font-size: 0.85rem;
      color: var(--text-muted);
      margin-top: 0.25rem;
    }

    .results-list {
      margin-top: 0.7rem;
      border-top: 1px solid #e5e7eb;
      padding-top: 0.5rem;
      max-height: 280px;
      overflow-y: auto;
    }

    .result-item {
      padding: 0.45rem 0.45rem 0.45rem 0;
      border-bottom: 1px dashed #e5e7eb;
      font-size: 0.85rem;
    }

    .result-item:last-child {
      border-bottom: none;
    }

    .result-item-header {
      display: flex;
      justify-content: space-between;
      gap: 0.4rem;
      align-items: baseline;
    }

    .result-pill {
      padding: 0.05rem 0.5rem;
      border-radius: 999px;
      font-size: 0.75rem;
      display: inline-flex;
      align-items: center;
      gap: 0.3rem;
    }

    .result-pill.correct {
      background: #dcfce7;
      color: #166534;
      border: 1px solid #bbf7d0;
    }

    .result-pill.incorrect {
      background: #fee2e2;
      color: #991b1b;
      border: 1px solid #fecaca;
    }

    .result-q {
      margin-top: 0.2rem;
    }

    .result-line {
      margin-top: 0.15rem;
    }

    .result-line strong {
      font-weight: 600;
    }

    footer {
      text-align: center;
      margin-top: 2rem;
      font-size: 0.8rem;
      color: var(--text-muted);
    }

    footer span.heart {
      color: #f97373;
    }
  </style>
</head>
<body>
  <div class="page">
    <header class="hero">
      <div class="hero-content">
        <div class="hero-text">
          <h1>Reflection of Light</h1>
          <p>Created by <strong>Rajgopal V</strong></p>
          <p>For Grade 9, <strong>VarshaNagar MPS</strong></p>
        </div>
        <div class="hero-badges">
          <div class="badge">
            <span class="icon">üéØ</span>
            <span>5 Sections &bull; Concept + Practice</span>
          </div>
          <div class="badge">
            <span class="icon">üß†</span>
            <span>Mental Map + Guided Q&amp;A</span>
          </div>
          <div class="badge">
            <span class="icon">üèÜ</span>
            <span>Progress bar &amp; score at the end</span>
          </div>
        </div>
      </div>
    </header>

    <!-- MAIN OVERVIEW / MENTAL MAP -->
    <section class="section" id="overview">
      <h2>
        Topic Overview
        <span class="tagline">How this lesson on Light Reflection &amp; Mirrors is organised</span>
      </h2>

      <div class="overview-layout">
        <!-- Big overview text -->
        <div class="card">
          <h3>Mental Map: Light Reflection &amp; Mirrors</h3>
          <p class="muted" style="margin-bottom: 0.6rem;">
            Use this as a mental map for the whole chapter. The topic is clearly broken into
            <strong>5 sections</strong>. Each section has its own:
            <strong>Overview</strong> (concept map) and <strong>Q&amp;A</strong> (quiz).
          </p>
          <p class="muted" style="margin-bottom: 0.6rem;">
            Click on <strong>Overview</strong> in any section card to see the
            <strong>mental map</strong> for that section.
          </p>
          <p class="muted" style="margin-bottom: 0.6rem;">
            Click on <strong>Start Q&amp;A</strong> in that section to practice questions only from that part of the chapter.
          </p>
        </div>

        <!-- How to use this page -->
        <div class="card">
          <h3>How to use this quiz page</h3>
          <ol class="how-to-list">
            <li>Select one of the <strong>5 sections</strong> below.</li>
            <li>Click <strong>Overview</strong> to see the mental map for that section.</li>
            <li>Click <strong>Q&amp;A</strong> to answer questions from that section.</li>
            <li>While answering, you can open the <strong>mental map on the side</strong> to help you.</li>
            <li>At the end of each section, you get your <strong>score</strong> and can see the correct answers.</li>
          </ol>
        </div>
      </div>
    </section>

    <!-- SECTION CARDS -->
    <section class="section" id="sections">
      <h2>
        Choose a Section
        <span class="tagline">Each section has its own Overview &amp; Q&amp;A</span>
      </h2>

      <div class="section-grid">
        <article class="section-card" data-section="plane">
          <h3>
            Plane Mirrors
            <span class="section-chip">Section 1</span>
          </h3>
          <p>Flat mirrors, virtual images, lateral inversion and simple ideas like ‚ÄúHow tall should a mirror be?‚Äù</p>
          <div class="section-actions">
            <button class="btn btn-outline" data-action="overview" data-section="plane">Overview (mental map)</button>
            <button class="btn btn-primary" data-action="quiz" data-section="plane">
              Start Q&amp;A
            </button>
          </div>
        </article>

        <article class="section-card" data-section="spherical">
          <h3>
            Spherical Mirrors
            <span class="section-chip">Section 2</span>
          </h3>
          <p>Concave and convex mirrors, pole, centre of curvature, principal axis, focus and focal length.</p>
          <div class="section-actions">
            <button class="btn btn-outline" data-action="overview" data-section="spherical">Overview (mental map)</button>
            <button class="btn btn-primary" data-action="quiz" data-section="spherical">
              Start Q&amp;A
            </button>
          </div>
        </article>

        <article class="section-card" data-section="image_formation">
          <h3>
            Image Formation
            <span class="section-chip">Section 3</span>
          </h3>
          <p>Where the image appears for different object positions and how the nature of image changes.</p>
          <div class="section-actions">
            <button class="btn btn-outline" data-action="overview" data-section="image_formation">Overview (mental map)</button>
            <button class="btn btn-primary" data-action="quiz" data-section="image_formation">
              Start Q&amp;A
            </button>
          </div>
        </article>

        <article class="section-card" data-section="formulas">
          <h3>
            Formulas &amp; Calculations
            <span class="section-chip">Section 4</span>
          </h3>
          <p>Cartesian sign convention, mirror formula and magnification formulas for height and distances.</p>
          <div class="section-actions">
            <button class="btn btn-outline" data-action="overview" data-section="formulas">Overview (mental map)</button>
            <button class="btn btn-primary" data-action="quiz" data-section="formulas">
              Start Q&amp;A
            </button>
          </div>
        </article>

        <article class="section-card" data-section="applications">
          <h3>
            Applications
            <span class="section-chip">Section 5</span>
          </h3>
          <p>Real life examples: dentist mirror, torches, car headlamps and rear-view mirrors on vehicles.</p>
          <div class="section-actions">
            <button class="btn btn-outline" data-action="overview" data-section="applications">Overview (mental map)</button>
            <button class="btn btn-primary" data-action="quiz" data-section="applications">
              Start Q&amp;A
            </button>
          </div>
        </article>
      </div>

      <!-- Section-specific overviews (mental maps) -->
      <div class="section-overview" id="section-overview-block" style="display:none;">
        <h3 id="so-title">Section Overview</h3>
        <div class="section-overview-block">
          <strong id="so-heading"></strong>
          <div id="so-content" class="section-overview-arrows"></div>
        </div>
      </div>
    </section>

    <!-- QUIZ AREA -->
    <section class="section" id="quiz-area">
      <h2>
        Section Q&amp;A
        <span class="tagline">Attempt the questions for the section you selected</span>
      </h2>

      <div id="quiz-container">
        <div class="quiz-header">
          <div class="quiz-header-title">
            <span>Now attempting:</span>
            <span class="section-name" id="quiz-section-name">Plane Mirrors</span>
            <small id="quiz-question-count">(0 questions)</small>
          </div>
          <button class="toggle-map-btn" id="toggle-map-btn">
            <span class="icon">üß≠</span>
            <span id="toggle-map-label">Show mental map while answering</span>
          </button>
        </div>

        <div class="quiz-layout">
          <!-- main quiz card -->
          <div class="quiz-card">
            <div class="progress-bar-wrapper">
              <div class="progress-bar-fill" id="progress-bar"></div>
            </div>
            <div class="quiz-status-line">
              <span id="question-counter">Question 1 of 1</span>
              <span id="attempt-status">Answer to unlock next question</span>
            </div>
            <div class="quiz-question-text" id="question-text">
              Question text will appear here.
            </div>
            <ul class="options-list" id="options-list">
              <!-- options injected by JS -->
            </ul>
            <div class="quiz-nav">
              <div class="quiz-nav-left">
                <button class="btn btn-outline btn-small" id="prev-btn">‚Üê Previous</button>
                <button class="btn btn-outline btn-small" id="next-btn">Next ‚Üí</button>
                <button class="btn-ghost" id="reset-section-btn" title="Clear your answers for this section">
                  <span>Reset section</span>
                </button>
              </div>
              <div class="quiz-nav-right">
                <button class="btn btn-primary btn-small" id="submit-section-btn">
                  Submit section &amp; see answers
                </button>
              </div>
            </div>
          </div>

          <!-- mental map panel -->
          <aside id="section-map-panel">
            <!-- Filled by JS -->
          </aside>
        </div>

        <!-- Results card -->
        <div class="quiz-card" id="results-card">
          <div class="results-header">
            <div>
              <div class="results-score" id="results-score-line">
                You scored 0 / 0
              </div>
              <div class="results-summary" id="results-summary">
                Complete the section to see your score and detailed answers.
              </div>
            </div>
            <button class="btn btn-outline btn-small" id="retry-btn">
              Try this section again
            </button>
          </div>
          <div class="results-list" id="results-list">
            <!-- Filled by JS -->
          </div>
        </div>
      </div>
    </section>

    <footer>
      Reflection of Light Quiz &bull; Grade 9, VarshaNagar MPS &bull; Created by
      <strong>Rajgopal V</strong> <span class="heart">‚òÖ</span>
    </footer>
  </div>

  <script>
    /* -----------------------------
       QUESTION BANK (50 questions)
       Student-friendly wording
       ----------------------------- */

    const QUESTION_BANK = [
      // Section: Plane Mirrors
      {
        id: 1,
        section: "plane",
        question:
          "In a plane (flat) mirror, how far is the image from the mirror compared to how far the object is from the mirror?",
        answer:
          "The perpendicular distance of the image from the mirror is equal to the perpendicular distance of the source from the mirror.",
      },
      {
        id: 2,
        section: "plane",
        question:
          "In a plane mirror, how big is the image compared to the object?",
        answer:
          "The image formed by a plane mirror is of the same size as the source.",
      },
      {
        id: 3,
        section: "plane",
        question:
          "When writing in front of a mirror looks reversed (left and right are swapped), what is this effect called?",
        answer: "This phenomenon is called lateral inversion.",
      },
      {
        id: 4,
        section: "plane",
        question:
          "Two plane mirrors are kept at an angle A to each other. Which formula do we use to find the number of images n formed?",
        answer: "n = (360¬∞/A) - 1",
      },
      {
        id: 5,
        section: "plane",
        question:
          "To see your full body in a plane mirror, the minimum height of the mirror should be what fraction of your own height?",
        answer: "half",
      },
      {
        id: 49,
        section: "plane",
        question:
          "Which type of image can be obtained on a screen (for example, on a wall or a sheet of paper)?",
        answer: "A real image.",
      },
      {
        id: 50,
        section: "plane",
        question:
          "Which type of image is formed behind the mirror and cannot be obtained on a screen?",
        answer: "A virtual image.",
      },

      // Section: Spherical Mirrors
      {
        id: 6,
        section: "spherical",
        question:
          "What do we call a spherical mirror that reflects light from its inner, curved-in surface?",
        answer: "It is called a concave mirror.",
      },
      {
        id: 7,
        section: "spherical",
        question:
          "What do we call a spherical mirror that reflects light from its outer, curved-out surface?",
        answer: "It is called a convex mirror.",
      },
      {
        id: 8,
        section: "spherical",
        question:
          "In a spherical mirror, what do we call the middle point of the mirror surface?",
        answer: "The pole (P).",
      },
      {
        id: 9,
        section: "spherical",
        question:
          "For a spherical mirror, what do we call the centre of the imaginary sphere of which the mirror is a part?",
        answer: "The centre of curvature (C).",
      },
      {
        id: 10,
        section: "spherical",
        question:
          "For a spherical mirror, what do we call the radius of the imaginary sphere of which the mirror is a part?",
        answer: "The radius of curvature (R).",
      },
      {
        id: 11,
        section: "spherical",
        question:
          "What do we call the straight line that passes through the pole and the centre of curvature of a spherical mirror?",
        answer: "It is called the principal axis.",
      },
      {
        id: 12,
        section: "spherical",
        question:
          "For a concave mirror, where do rays that come in parallel to the principal axis meet after reflection?",
        answer: "The principal focus (F).",
      },
      {
        id: 13,
        section: "spherical",
        question:
          "For a convex mirror, parallel rays appear to come from which point after reflection?",
        answer:
          "They appear to come from a particular point behind the mirror, called the principal focus.",
      },
      {
        id: 14,
        section: "spherical",
        question:
          "What do we call the distance between the pole and the principal focus of a spherical mirror?",
        answer: "It is called the focal length (f).",
      },
      {
        id: 15,
        section: "spherical",
        question:
          "How is the focal length f related to the radius of curvature R for a spherical mirror?",
        answer: "The focal length is half of the radius of curvature: f = R/2.",
      },
      {
        id: 16,
        section: "spherical",
        question:
          "Ray rule 1 for a concave mirror: A ray comes in parallel to the principal axis and hits the mirror. Through which point does it pass after reflection?",
        answer: "principal focus",
      },
      {
        id: 17,
        section: "spherical",
        question:
          "Ray rule 2 for a concave mirror: A ray passes through the principal focus and hits the mirror. How does it travel after reflection?",
        answer: "parallel to the principal axis",
      },
      {
        id: 18,
        section: "spherical",
        question:
          "Ray rule 3 for a spherical mirror: What happens to a ray that passes through the centre of curvature and then hits the mirror?",
        answer: "The reflected ray traces the same path back.",
      },
      {
        id: 32,
        section: "spherical",
        question:
          "A concave mirror brings parallel rays together at a point. What special name is given to it because of this?",
        answer: "focusing (or converging)",
      },
      {
        id: 33,
        section: "spherical",
        question:
          "A convex mirror spreads parallel rays out. What special name is given to it because of this?",
        answer: "dispersing (or diverging)",
      },

      // Section: Image Formation
      {
        id: 19,
        section: "image_formation",
        question:
          "When an object is very far away from a concave mirror (almost at infinity), what kind of image is formed and where is it formed?",
        answer:
          "A point image, which is real and inverted, is formed at the focus.",
      },
      {
        id: 20,
        section: "image_formation",
        question:
          "When an object is placed beyond the centre of curvature of a concave mirror, where is its image formed?",
        answer:
          "The image is formed between the centre of curvature and the focus.",
      },
      {
        id: 21,
        section: "image_formation",
        question:
          "For a concave mirror, when the object is beyond the centre of curvature, what is the nature and size of the image?",
        answer:
          "The image is real, inverted, and diminished (smaller than the object).",
      },
      {
        id: 22,
        section: "image_formation",
        question:
          "When an object is placed at the centre of curvature of a concave mirror, where is the image formed?",
        answer: "The image is formed at the centre of curvature.",
      },
      {
        id: 23,
        section: "image_formation",
        question:
          "For a concave mirror with the object at the centre of curvature, what is the nature and size of the image?",
        answer:
          "The image is real, inverted, and the same size as the object.",
      },
      {
        id: 24,
        section: "image_formation",
        question:
          "For a concave mirror, when the object is kept between the centre of curvature and the focus, where is the image formed?",
        answer: "The image is formed beyond the centre of curvature.",
      },
      {
        id: 25,
        section: "image_formation",
        question:
          "For a concave mirror, when the object is between the centre of curvature and the focus, what is the nature and size of the image?",
        answer:
          "The image is real, inverted, and magnified (larger than the object).",
      },
      {
        id: 26,
        section: "image_formation",
        question:
          "For a concave mirror, when an object is placed exactly at the focus, where is the image formed?",
        answer: "The image is formed at infinity.",
      },
      {
        id: 27,
        section: "image_formation",
        question:
          "For a concave mirror with the object at the focus, what is the nature and size of the image?",
        answer: "The image is real, inverted, and very large.",
      },
      {
        id: 28,
        section: "image_formation",
        question:
          "For a concave mirror, when the object is placed between the pole and the focus, where is the image formed?",
        answer: "The image is formed behind the mirror.",
      },
      {
        id: 29,
        section: "image_formation",
        question:
          "For a concave mirror, when the object is between the pole and the focus, what is the nature and size of the image?",
        answer: "The image is virtual, erect, and magnified.",
      },
      {
        id: 30,
        section: "image_formation",
        question:
          "For a convex mirror, what is the nature of the image that is formed, no matter where the object is placed?",
        answer:
          "The image is always virtual, erect, and smaller than the object.",
      },
      {
        id: 31,
        section: "image_formation",
        question:
          "For a convex mirror, where is the image always located?",
        answer: "The image is always situated behind the mirror.",
      },

      // Section: Formulas & Calculations
      {
        id: 37,
        section: "formulas",
        question:
          "According to the Cartesian sign convention for mirrors, on which side of the mirror is the object always kept?",
        answer: "The object is always kept on the left of the mirror.",
      },
      {
        id: 38,
        section: "formulas",
        question:
          "In the Cartesian sign convention for mirrors, from which point are all distances along the principal axis measured?",
        answer: "pole of the mirror",
      },
      {
        id: 39,
        section: "formulas",
        question:
          "In this sign convention, distances measured to the right of the pole are taken as what sign, and distances to the left are taken as what sign?",
        answer: "positive, negative",
      },
      {
        id: 40,
        section: "formulas",
        question:
          "In this sign convention, distances measured vertically upwards from the principal axis are given which sign, and those measured downwards are given which sign?",
        answer: "positive, negative",
      },
      {
        id: 41,
        section: "formulas",
        question:
          "According to the sign convention, is the focal length of a concave mirror positive or negative?",
        answer: "The focal length of a concave mirror is negative.",
      },
      {
        id: 42,
        section: "formulas",
        question:
          "According to the sign convention, is the focal length of a convex mirror positive or negative?",
        answer: "The focal length of a convex mirror is positive.",
      },
      {
        id: 43,
        section: "formulas",
        question:
          "Which formula connects the object distance u, image distance v and focal length f for a spherical mirror?",
        answer: "1/f = 1/v + 1/u",
      },
      {
        id: 44,
        section: "formulas",
        question:
          "What does the magnification M produced by a spherical mirror tell us about the image?",
        answer:
          "It tells us how large the image is as compared to the object.",
      },
      {
        id: 45,
        section: "formulas",
        question:
          "What is the formula for magnification M in terms of the height of the image h‚ÇÇ and the height of the object h‚ÇÅ?",
        answer: "M = h‚ÇÇ / h‚ÇÅ",
      },
      {
        id: 46,
        section: "formulas",
        question:
          "What is the formula for magnification M in terms of the image distance v and the object distance u?",
        answer: "M = v / u",
      },
      {
        id: 47,
        section: "formulas",
        question:
          "If the height of an object is positive, what does it mean if the height of the image is negative?",
        answer: "It signifies that the image is real and inverted.",
      },
      {
        id: 48,
        section: "formulas",
        question:
          "If the height of an object is positive, what does it mean if the height of the image is also positive?",
        answer: "It signifies that the image is virtual and erect.",
      },

      // Section: Applications
      {
        id: 34,
        section: "applications",
        question:
          "Which type of mirror do dentists and barbers use when they want a magnified view of teeth or face?",
        answer: "A concave mirror.",
      },
      {
        id: 35,
        section: "applications",
        question:
          "Which type of mirror is used in torches and headlamps of vehicles to get a strong parallel beam of light?",
        answer: "A concave mirror is used to obtain a parallel beam of light.",
      },
      {
        id: 36,
        section: "applications",
        question:
          "Which type of mirror is used as a side-view or rear-view mirror in cars and motorcycles?",
        answer: "A convex mirror.",
      },
    ];

    /* -----------------------------
       Section mental map content
       ----------------------------- */

    const SECTION_MAPS = {
      plane: {
        title: "Plane Mirrors ‚Äì Mental Map",
        overview: `
          <p><strong>Plane Mirrors ‚Äì Big Picture</strong></p>
          <ul class="flow-steps">
            <li class="flow-step" data-step="1">
              <div class="flow-step-title">Flat reflecting surface</div>
              <div class="flow-step-body">
                A plane mirror is a flat, smooth, shining surface that reflects light.
              </div>
            </li>
            <li class="flow-step" data-step="2">
              <div class="flow-step-title">Image in a plane mirror</div>
              <div class="flow-step-body">
                The image is <strong>virtual</strong>, the <strong>same size</strong> as the object and appears the
                <strong>same distance behind the mirror</strong> as the object is in front.
              </div>
            </li>
            <li class="flow-step" data-step="3">
              <div class="flow-step-title">Left‚Äìright reversal</div>
              <div class="flow-step-body">
                The mirror swaps left and right. This effect is called
                <strong>lateral inversion</strong>.
              </div>
            </li>
            <li class="flow-step" data-step="4">
              <div class="flow-step-title">How tall should the mirror be?</div>
              <div class="flow-step-body">
                To see your full body, the minimum height of the mirror should be
                <strong>half your height</strong>.
              </div>
            </li>
            <li class="flow-step" data-step="5">
              <div class="flow-step-title">Two plane mirrors</div>
              <div class="flow-step-body">
                When two plane mirrors are kept at an angle A, the number of images (n) is given by
                <strong>n = (360¬∞ / A) - 1</strong>.
              </div>
            </li>
          </ul>
        `,
        bullets: [
          "Plane mirror: flat reflective surface.",
          "Image is virtual, same size and same distance behind the mirror as the object in front.",
          "Left‚Äìright reversal is called lateral inversion.",
          "To see full body, mirror height should be half the height of the person.",
          "Two mirrors at angle A: number of images n = (360¬∞ / A) - 1."
        ],
      },
      spherical: {
        title: "Spherical Mirrors ‚Äì Mental Map",
        overview: `
          <p><strong>Spherical Mirrors ‚Äì Big Picture</strong></p>
          <ul class="flow-steps">
            <li class="flow-step" data-step="1">
              <div class="flow-step-title">Curved mirrors</div>
              <div class="flow-step-body">
                Spherical mirrors are pieces of a sphere. They can be
                <strong>concave</strong> (curved inwards) or <strong>convex</strong> (curved outwards).
              </div>
            </li>
            <li class="flow-step" data-step="2">
              <div class="flow-step-title">Concave vs convex</div>
              <div class="flow-step-body">
                Concave mirror: inner surface reflects (converging / focusing mirror).<br/>
                Convex mirror: outer surface reflects (diverging / dispersing mirror).
              </div>
            </li>
            <li class="flow-step" data-step="3">
              <div class="flow-step-title">Important points on the mirror</div>
              <ul class="flow-subpoints">
                <li><strong>Pole (P)</strong> ‚Äì middle point of the mirror surface.</li>
                <li><strong>Centre of curvature (C)</strong> ‚Äì centre of the sphere from which the mirror is cut.</li>
                <li><strong>Radius of curvature (R)</strong> ‚Äì radius of that sphere.</li>
              </ul>
            </li>
            <li class="flow-step" data-step="4">
              <div class="flow-step-title">Principal axis & principal focus</div>
              <div class="flow-step-body">
                Principal axis: straight line through P and C.<br/>
                Principal focus (F): point where rays parallel to the principal axis meet, or appear to come from.
              </div>
            </li>
            <li class="flow-step" data-step="5">
              <div class="flow-step-title">Focal length</div>
              <div class="flow-step-body">
                Focal length <strong>f</strong> is the distance PF, and it satisfies <strong>f = R / 2</strong>.
              </div>
            </li>
          </ul>
        `,
        bullets: [
          "Spherical mirrors are parts of a sphere.",
          "Concave mirror: inner surface reflects (focusing / converging mirror).",
          "Convex mirror: outer surface reflects (dispersing / diverging mirror).",
          "Pole (P), centre of curvature (C) and radius of curvature (R) are key points.",
          "Principal axis passes through P and C.",
          "Principal focus (F): where parallel rays meet or appear to meet.",
          "Focal length f = R / 2."
        ],
      },
      image_formation: {
        title: "Image Formation ‚Äì Mental Map",
        overview: `
          <p><strong>Image Formation ‚Äì Big Picture</strong></p>
          <ul class="flow-steps">
            <li class="flow-step" data-step="1">
              <div class="flow-step-title">Concave mirror ‚Äì object very far away</div>
              <div class="flow-step-body">
                Object at a very large distance (almost at infinity) ‚Üí tiny real, inverted image at the focus.
              </div>
            </li>
            <li class="flow-step" data-step="2">
              <div class="flow-step-title">Object beyond centre of curvature (C)</div>
              <div class="flow-step-body">
                Image forms between C and F ‚Üí real, inverted, smaller than the object.
              </div>
            </li>
            <li class="flow-step" data-step="3">
              <div class="flow-step-title">Object at centre of curvature (C)</div>
              <div class="flow-step-body">
                Image forms at C ‚Üí real, inverted, same size as the object.
              </div>
            </li>
            <li class="flow-step" data-step="4">
              <div class="flow-step-title">Object between C and F</div>
              <div class="flow-step-body">
                Image forms beyond C ‚Üí real, inverted, bigger than the object.
              </div>
            </li>
            <li class="flow-step" data-step="5">
              <div class="flow-step-title">Object at focus (F)</div>
              <div class="flow-step-body">
                Image forms at infinity (very far away) ‚Üí real, inverted and very large.
              </div>
            </li>
            <li class="flow-step" data-step="6">
              <div class="flow-step-title">Object between pole (P) and focus (F)</div>
              <div class="flow-step-body">
                Image forms behind the mirror ‚Üí virtual, erect and magnified.
              </div>
            </li>
            <li class="flow-step" data-step="7">
              <div class="flow-step-title">Convex mirror</div>
              <div class="flow-step-body">
                For any object position ‚Üí image is always virtual, erect and smaller, and appears behind the mirror.
              </div>
            </li>
          </ul>
        `,
        bullets: [
          "Concave mirror: image changes as object moves (infinity, beyond C, at C, between C and F, at F, between P and F).",
          "Object at infinity ‚Üí tiny real inverted image at focus.",
          "Beyond C ‚Üí real, inverted, smaller image between C and F.",
          "At C ‚Üí real, inverted, same size image at C.",
          "Between C and F ‚Üí real, inverted, magnified image beyond C.",
          "At F ‚Üí real, inverted image at infinity, very large.",
          "Between P and F ‚Üí virtual, erect, magnified image behind mirror.",
          "Convex mirror ‚Üí always virtual, erect, diminished image behind mirror."
        ],
      },
      formulas: {
        title: "Formulas & Calculations ‚Äì Mental Map",
        overview: `
          <p><strong>Formulas &amp; Calculations ‚Äì Step-by-step</strong></p>
          <ul class="flow-steps">
            <li class="flow-step" data-step="1">
              <div class="flow-step-title">Cartesian sign convention</div>
              <div class="flow-step-body">
                The object is always placed on the <strong>left side</strong> of the mirror.
              </div>
            </li>
            <li class="flow-step" data-step="2">
              <div class="flow-step-title">How distances are measured</div>
              <ul class="flow-subpoints">
                <li>All distances are measured from the <strong>pole (P)</strong> along the principal axis.</li>
                <li><strong>Right of P</strong> ‚Üí distances are taken as <strong>positive</strong>.</li>
                <li><strong>Left of P</strong> ‚Üí distances are taken as <strong>negative</strong>.</li>
                <li><strong>Upwards</strong> from the axis ‚Üí positive heights.</li>
                <li><strong>Downwards</strong> from the axis ‚Üí negative heights.</li>
              </ul>
            </li>
            <li class="flow-step" data-step="3">
              <div class="flow-step-title">Sign of focal length</div>
              <div class="flow-step-body">
                For a <strong>concave mirror</strong>, the focal length <strong>f is negative</strong>.<br/>
                For a <strong>convex mirror</strong>, the focal length <strong>f is positive</strong>.
              </div>
            </li>
            <li class="flow-step" data-step="4">
              <div class="flow-step-title">Mirror formula</div>
              <div class="flow-step-body">
                The object distance (<strong>u</strong>), image distance (<strong>v</strong>) and focal length (<strong>f</strong>)
                are related by:<br/>
                <strong>1/f = 1/v + 1/u</strong>
              </div>
            </li>
            <li class="flow-step" data-step="5">
              <div class="flow-step-title">Magnification formulas</div>
              <div class="flow-step-body">
                Magnification <strong>M</strong> tells us how big the image is compared to the object.
              </div>
              <ul class="flow-subpoints">
                <li>Using heights: <strong>M = h‚ÇÇ / h‚ÇÅ</strong> (image height √∑ object height).</li>
                <li>Using distances: <strong>M = v / u</strong>.</li>
                <li>Sign of height: negative height ‚Üí real, inverted image; positive height ‚Üí virtual, erect image.</li>
              </ul>
            </li>
          </ul>
        `,
        bullets: [
          "Object is placed on the left side of the mirror.",
          "Distances are measured from pole (P) along the principal axis.",
          "Right of P ‚Üí positive, left of P ‚Üí negative.",
          "Upwards from axis ‚Üí positive heights, downwards ‚Üí negative heights.",
          "Concave mirror has negative focal length f.",
          "Convex mirror has positive focal length f.",
          "Mirror formula: 1/f = 1/v + 1/u.",
          "Magnification M tells how big the image is compared to the object.",
          "M = h‚ÇÇ / h‚ÇÅ and M = v / u.",
          "Negative height ‚Üí real, inverted image; positive height ‚Üí virtual, erect image."
        ],
      },
      applications: {
        title: "Applications ‚Äì Mental Map",
        overview: `
          <p><strong>Applications ‚Äì Where we use mirrors in real life</strong></p>
          <ul class="flow-steps">
            <li class="flow-step" data-step="1">
              <div class="flow-step-title">Concave mirror ‚Äì close up and bright beams</div>
              <ul class="flow-subpoints">
                <li><strong>Dentists and barbers</strong> use concave mirrors for a magnified close-up view.</li>
                <li><strong>Torch and vehicle headlamps</strong> use concave mirrors to send a strong parallel beam of light.</li>
              </ul>
            </li>
            <li class="flow-step" data-step="2">
              <div class="flow-step-title">Convex mirror ‚Äì wider view</div>
              <ul class="flow-subpoints">
                <li><strong>Rear-view and side-view mirrors</strong> in vehicles use convex mirrors.</li>
                <li>They give a <strong>wider field of view</strong>. The image is <strong>smaller but erect</strong>, so you can see more traffic behind.</li>
              </ul>
            </li>
          </ul>
        `,
        bullets: [
          "Concave mirrors are used by dentists and barbers for magnified views.",
          "Concave mirrors are used in torches and headlamps to produce parallel beams.",
          "Convex mirrors are used as rear-view and side-view mirrors in vehicles.",
          "Convex mirrors give a wider field of view; images are smaller but erect."
        ],
      },
    };

    /* -----------------------------
       Quiz logic
       ----------------------------- */

    const SECTION_LABELS = {
      plane: "Plane Mirrors",
      spherical: "Spherical Mirrors",
      image_formation: "Image Formation",
      formulas: "Formulas & Calculations",
      applications: "Applications",
    };

    let currentSection = null;
    let currentQuestions = [];
    let currentIndex = 0;
    let userAnswers = []; // store index of chosen option or null
    let resultsShown = false;

    function shuffleArray(arr) {
      const a = [...arr];
      for (let i = a.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [a[i], a[j]] = [a[j], a[i]];
      }
      return a;
    }

    function buildQuizForSection(sectionKey) {
      const baseQuestions = QUESTION_BANK.filter(
        (q) => q.section === sectionKey
      );
      const allAnswers = QUESTION_BANK.map((q) => q.answer);

      // For each question, generate 4 options (1 correct + 3 random wrong)
      return baseQuestions.map((q) => {
        const wrongOptions = shuffleArray(
          allAnswers.filter((a) => a !== q.answer)
        ).slice(0, 3);
        const options = shuffleArray([q.answer, ...wrongOptions]);
        const correctIndex = options.indexOf(q.answer);
        return { ...q, options, correctIndex };
      });
    }

    function renderSectionOverview(sectionKey) {
      const block = document.getElementById("section-overview-block");
      const titleEl = document.getElementById("so-title");
      const headingEl = document.getElementById("so-heading");
      const contentEl = document.getElementById("so-content");

      const map = SECTION_MAPS[sectionKey];
      if (!map) return;

      block.style.display = "block";
      titleEl.textContent = "Section Overview ‚Äì " + SECTION_LABELS[sectionKey];
      headingEl.textContent = map.title;
      contentEl.innerHTML = map.overview || "";

      block.scrollIntoView({ behavior: "smooth", block: "start" });
    }

    function startSectionQuiz(sectionKey) {
      currentSection = sectionKey;
      currentQuestions = buildQuizForSection(sectionKey);
      currentIndex = 0;
      userAnswers = new Array(currentQuestions.length).fill(null);
      resultsShown = false;

      const label = SECTION_LABELS[sectionKey];
      document.getElementById("quiz-section-name").textContent = label;
      document.getElementById(
        "quiz-question-count"
      ).textContent = `(${currentQuestions.length} questions)`;

      document.getElementById("quiz-container").classList.add("active");
      document.getElementById("results-card").classList.remove("active");
      document.getElementById("results-summary").textContent =
        "Answer all questions and submit to see your score and correct answers.";
      document.getElementById("attempt-status").textContent =
        "Choose an option and then use Next / Previous to move around.";

      // Load FULL mental map (same as overview) inside Q&A side panel
const panel = document.getElementById("section-map-panel");
const map = SECTION_MAPS[sectionKey];

panel.innerHTML = `
  <h4>${map.title}</h4>
  <div class="full-map-scroll">${map.overview}</div>
`;


      panel.classList.remove("active");
      document.getElementById("toggle-map-label").textContent =
        "Show mental map while answering";

      renderCurrentQuestion();
      document
        .getElementById("quiz-area")
        .scrollIntoView({ behavior: "smooth", block: "start" });
    }

    function renderCurrentQuestion() {
      if (!currentQuestions.length) return;

      const qObj = currentQuestions[currentIndex];
      const total = currentQuestions.length;

      document.getElementById(
        "question-counter"
      ).textContent = `Question ${currentIndex + 1} of ${total}`;
      document.getElementById("question-text").textContent = qObj.question;

      const progress = ((currentIndex + 1) / total) * 100;
      document.getElementById("progress-bar").style.width = progress + "%";

      const list = document.getElementById("options-list");
      list.innerHTML = "";

      const letters = ["A", "B", "C", "D"];
      qObj.options.forEach((opt, idx) => {
        const li = document.createElement("li");
        li.className = "option-item";

        const input = document.createElement("input");
        input.type = "radio";
        input.name = "option";
        input.value = idx;

        const labelSpan = document.createElement("span");
        labelSpan.className = "option-letter";
        labelSpan.textContent = letters[idx];

        const textSpan = document.createElement("span");
        textSpan.className = "option-text";
        textSpan.textContent = opt;

        li.appendChild(input);
        li.appendChild(labelSpan);
        li.appendChild(textSpan);

        // mark selected if user already chose
        if (userAnswers[currentIndex] === idx) {
          input.checked = true;
          li.classList.add("selected");
        }

        li.addEventListener("click", () => {
          // When clicking, select this option
          userAnswers[currentIndex] = idx;
          // update visual selection
          document
            .querySelectorAll(".option-item")
            .forEach((item) => item.classList.remove("selected"));
          li.classList.add("selected");
          input.checked = true;
          document.getElementById("attempt-status").textContent =
            "Answer saved. Use Next or Previous to move.";
        });

        list.appendChild(li);
      });

      // disable prev / next at ends
      document.getElementById("prev-btn").disabled = currentIndex === 0;
      document.getElementById("next-btn").disabled =
        currentIndex === total - 1;
    }

    function showResults() {
      const total = currentQuestions.length;
      let correct = 0;

      const resultsList = document.getElementById("results-list");
      resultsList.innerHTML = "";

      currentQuestions.forEach((q, index) => {
        const userAns = userAnswers[index];
        const isCorrect = userAns === q.correctIndex;
        if (isCorrect) correct++;

        const item = document.createElement("div");
        item.className = "result-item";

        const header = document.createElement("div");
        header.className = "result-item-header";

        const left = document.createElement("div");
        left.textContent = `Q${index + 1}`;

        const pill = document.createElement("div");
        pill.className =
          "result-pill " + (isCorrect ? "correct" : "incorrect");
        pill.innerHTML = isCorrect
          ? "‚úî Correct"
          : userAns === null
          ? "‚ö† Not answered"
          : "‚úñ Incorrect";

        header.appendChild(left);
        header.appendChild(pill);

        const qText = document.createElement("div");
        qText.className = "result-q";
        qText.textContent = q.question;

        const correctLine = document.createElement("div");
        correctLine.className = "result-line";
        correctLine.innerHTML =
          "<strong>Correct answer:</strong> " + q.options[q.correctIndex];

        const yourLine = document.createElement("div");
        yourLine.className = "result-line";
        yourLine.innerHTML =
          "<strong>Your answer:</strong> " +
          (userAns === null ? "Not answered" : q.options[userAns]);

        item.appendChild(header);
        item.appendChild(qText);
        item.appendChild(correctLine);
        item.appendChild(yourLine);

        resultsList.appendChild(item);
      });

      const scoreLine = document.getElementById("results-score-line");
      const summary = document.getElementById("results-summary");

      const percent = Math.round((correct / total) * 100);
      const cls = percent >= 60 ? "good" : "bad";

      scoreLine.innerHTML = `You scored <span class="${cls}">${correct} / ${total}</span> (${percent}%)`;

      if (percent === 100) {
        summary.textContent = "Excellent! You have mastered this section.";
      } else if (percent >= 60) {
        summary.textContent =
          "Good work! Revise the questions you got wrong, then try again.";
      } else {
        summary.textContent =
          "Keep practicing. Use the mental map to review the ideas, then retake the quiz.";
      }

      document.getElementById("results-card").classList.add("active");
      resultsShown = true;
    }

    /* -----------------------------
       Event wiring
       ----------------------------- */

    // Overview / Q&A buttons on section cards
    document.querySelectorAll(".section-card .section-actions .btn").forEach(
      (btn) => {
        btn.addEventListener("click", () => {
          const sectionKey = btn.getAttribute("data-section");
          const action = btn.getAttribute("data-action");
          if (!sectionKey || !action) return;

          if (action === "overview") {
            renderSectionOverview(sectionKey);
          } else if (action === "quiz") {
            startSectionQuiz(sectionKey);
          }
        });
      }
    );

    // Next / Prev
    document.getElementById("next-btn").addEventListener("click", () => {
      if (currentIndex < currentQuestions.length - 1) {
        currentIndex++;
        renderCurrentQuestion();
      }
    });

    document.getElementById("prev-btn").addEventListener("click", () => {
      if (currentIndex > 0) {
        currentIndex--;
        renderCurrentQuestion();
      }
    });

    // Submit section
    document
      .getElementById("submit-section-btn")
      .addEventListener("click", () => {
        if (!currentQuestions.length) return;

        const unanswered = userAnswers.filter((v) => v === null).length;
        if (
          unanswered > 0 &&
          !confirm(
            `You have not answered ${unanswered} question(s). Submit anyway and see answers?`
          )
        ) {
          return;
        }
        showResults();
      });

    // Show / hide mental map panel while answering
    document
      .getElementById("toggle-map-btn")
      .addEventListener("click", () => {
        const panel = document.getElementById("section-map-panel");
        panel.classList.toggle("active");
        const label = document.getElementById("toggle-map-label");
        if (panel.classList.contains("active")) {
          label.textContent = "Hide mental map";
        } else {
          label.textContent = "Show mental map while answering";
        }
      });

    // Reset section answers
    document
      .getElementById("reset-section-btn")
      .addEventListener("click", () => {
        if (
          !currentQuestions.length ||
          !confirm("Clear all your answers for this section?")
        ) {
          return;
        }
        userAnswers = new Array(currentQuestions.length).fill(null);
        currentIndex = 0;
        resultsShown = false;
        document.getElementById("results-card").classList.remove("active");
        renderCurrentQuestion();
      });

    // Retry section (from results)
    document.getElementById("retry-btn").addEventListener("click", () => {
      if (!currentSection) return;
      startSectionQuiz(currentSection);
    });
  </script>
</body>
</html>
