<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Reflection of Light ‚Äì Quiz</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      --bg: #0b1020;
      --bg-alt: #151b30;
      --bg-card: #1d2340;
      --accent: #4cc9f0;
      --accent-soft: rgba(76, 201, 240, 0.18);
      --accent-strong: #fca311;
      --text-main: #f3f4ff;
      --text-muted: #a0a4c0;
      --error: #ff4b81;
      --success: #3ddc97;
      --border-subtle: #2a3152;
      --shadow-soft: 0 18px 45px rgba(0,0,0,0.45);
      --radius-lg: 18px;
      --radius-pill: 999px;
      --transition-fast: 0.18s ease-out;
      --transition-med: 0.28s ease;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at 0% 0%, #253059 0, #090e1a 55%);
      color: var(--text-main);
      display: flex;
      justify-content: center;
      padding: 24px 12px 40px;
    }

    .app-shell {
      width: 100%;
      max-width: 1100px;
      background: linear-gradient(145deg, rgba(255,255,255,0.02), rgba(24,33,66,0.9));
      border-radius: 26px;
      box-shadow: var(--shadow-soft);
      border: 1px solid rgba(255,255,255,0.04);
      padding: 22px 22px 26px;
      backdrop-filter: blur(20px);
    }

    header.app-header {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      gap: 12px;
      align-items: center;
      margin-bottom: 18px;
      padding-bottom: 14px;
      border-bottom: 1px solid rgba(255,255,255,0.06);
    }

    .title-block h1 {
      margin: 0;
      font-size: 1.6rem;
      letter-spacing: 0.03em;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .title-pill {
      font-size: 0.7rem;
      padding: 3px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.16);
      text-transform: uppercase;
      letter-spacing: 0.09em;
      color: var(--accent);
      background: radial-gradient(circle at 0 0, rgba(255,255,255,0.12), transparent 55%);
    }

    .subtitle {
      font-size: 0.85rem;
      color: var(--text-muted);
      margin-top: 6px;
    }

    .subtitle span.highlight {
      color: var(--accent-strong);
      font-weight: 600;
    }

    .badge-strip {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      font-size: 0.75rem;
      color: var(--text-muted);
    }

    .badge {
      padding: 4px 10px;
      border-radius: var(--radius-pill);
      border: 1px solid rgba(255,255,255,0.12);
      background: rgba(9, 12, 31, 0.85);
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: var(--accent-strong);
      box-shadow: 0 0 10px rgba(252,163,17,0.6);
    }

    /* Section navigation */

    .section-nav {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 16px;
    }

    .section-tab {
      flex: 1 1 135px;
      min-width: 0;
      position: relative;
      padding: 8px 10px;
      border-radius: var(--radius-pill);
      border: 1px solid var(--border-subtle);
      background: linear-gradient(145deg, rgba(21,27,48,0.9), rgba(7,10,24,0.9));
      color: var(--text-muted);
      font-size: 0.8rem;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      cursor: pointer;
      transition: transform var(--transition-fast), box-shadow var(--transition-fast), border-color var(--transition-fast), background var(--transition-fast), color var(--transition-fast);
    }

    .section-tab span.icon {
      font-size: 0.85rem;
    }

    .section-tab.active {
      border-color: var(--accent);
      color: var(--text-main);
      background: radial-gradient(circle at 0 0, rgba(76,201,240,0.3), rgba(17,24,48,0.96));
      box-shadow: 0 0 0 1px rgba(76,201,240,0.18), 0 10px 25px rgba(0,0,0,0.5);
    }

    .section-tab:hover {
      transform: translateY(-1px);
      box-shadow: 0 8px 22px rgba(0,0,0,0.45);
    }

    /* View toggles (Overview / Q&A) */

    .view-toggle-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
      gap: 10px;
      flex-wrap: wrap;
    }

    .view-buttons {
      display: inline-flex;
      border-radius: var(--radius-pill);
      padding: 2px;
      background: rgba(8,12,32,0.85);
      border: 1px solid rgba(255,255,255,0.08);
    }

    .view-btn {
      padding: 7px 14px;
      border-radius: var(--radius-pill);
      border: none;
      background: transparent;
      color: var(--text-muted);
      font-size: 0.8rem;
      display: inline-flex;
      align-items: center;
      gap: 7px;
      cursor: pointer;
      transition: background var(--transition-fast), color var(--transition-fast), transform var(--transition-fast);
    }

    .view-btn span.icon {
      font-size: 0.85rem;
    }

    .view-btn.active {
      background: radial-gradient(circle at 0 0, rgba(76,201,240,0.3), rgba(20,27,54,0.96));
      color: var(--text-main);
      transform: translateY(-1px);
    }

    .view-btn:hover {
      transform: translateY(-1px);
    }

    .mini-info {
      font-size: 0.75rem;
      color: var(--text-muted);
    }

    .mini-info span.em {
      color: var(--accent);
      font-weight: 500;
    }

    /* Main content area */

    .content-card {
      background: rgba(9, 13, 34, 0.95);
      border-radius: 20px;
      border: 1px solid rgba(255,255,255,0.08);
      padding: 18px 16px 18px;
      min-height: 260px;
      box-shadow: 0 15px 40px rgba(0,0,0,0.55);
    }

    /* Mental map */

    .section-intro {
      margin-bottom: 12px;
      font-size: 0.9rem;
      color: var(--text-muted);
    }

    .mental-map {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-top: 6px;
    }

    .map-root {
      padding: 10px 12px;
      border-radius: 14px;
      background: linear-gradient(135deg, rgba(45, 58, 110, 0.9), rgba(20,24,54,0.9));
      border: 1px solid rgba(112, 160, 255, 0.6);
      display: inline-flex;
      align-items: center;
      gap: 8px;
      font-size: 0.9rem;
      font-weight: 500;
    }

    .map-root .bubble {
      width: 18px;
      height: 18px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 20%, #ffffff, #4cc9f0);
      box-shadow: 0 0 18px rgba(76,201,240,0.9);
    }

    .map-branches {
      margin-left: 12px;
      border-left: 1px dashed rgba(255,255,255,0.14);
      padding-left: 14px;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .map-branch {
      position: relative;
      padding: 8px 10px;
      border-radius: 12px;
      background: rgba(11,17,40,0.9);
      border: 1px solid rgba(255,255,255,0.06);
    }

    .map-branch::before {
      content: "";
      position: absolute;
      left: -14px;
      top: 50%;
      width: 10px;
      height: 1px;
      background: rgba(255,255,255,0.35);
    }

    .branch-title {
      font-size: 0.83rem;
      text-transform: uppercase;
      letter-spacing: 0.06em;
      color: var(--accent-strong);
      margin-bottom: 4px;
    }

    .branch-items {
      display: flex;
      flex-wrap: wrap;
      gap: 5px;
      font-size: 0.8rem;
    }

    .branch-pill {
      padding: 3px 8px;
      border-radius: 999px;
      background: rgba(32,49,96,0.86);
      border: 1px solid rgba(130,170,255,0.5);
      white-space: nowrap;
    }

    /* Quiz layout */

    .quiz-layout {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .map-toggle-bar {
      border-radius: 12px;
      padding: 8px 10px;
      background: rgba(15,18,38,0.9);
      border: 1px dashed rgba(255,255,255,0.18);
      display: flex;
      align-items: center;
      justify-content: space-between;
      font-size: 0.78rem;
      cursor: pointer;
    }

    .map-toggle-bar span.label {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      color: var(--text-muted);
    }

    .map-toggle-bar span.label strong {
      color: var(--accent);
      font-weight: 500;
    }

    .map-toggle-bar span.chevron {
      font-size: 0.8rem;
      transition: transform var(--transition-fast);
    }

    .map-toggle-bar.expanded span.chevron {
      transform: rotate(90deg);
    }

    .quiz-main-grid {
      display: grid;
      grid-template-columns: minmax(0, 1fr);
      gap: 10px;
    }

    .quiz-main-grid.with-map {
      grid-template-columns: minmax(0, 0.9fr) minmax(0, 1.1fr);
    }

    .quiz-map-panel {
      border-radius: 14px;
      background: radial-gradient(circle at 0 0, rgba(76,201,240,0.14), rgba(12,17,40,0.96));
      border: 1px solid rgba(95, 151, 255, 0.7);
      padding: 10px 10px;
      max-height: 260px;
      overflow: auto;
    }

    .quiz-card {
      border-radius: 16px;
      background: radial-gradient(circle at 0 0, rgba(76,201,240,0.08), rgba(13,18,40,0.95));
      border: 1px solid rgba(255,255,255,0.16);
      padding: 14px 14px 12px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .quiz-header-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
    }

    .quiz-title {
      font-size: 0.9rem;
      font-weight: 500;
      color: #e2e7ff;
    }

    .quiz-meta {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 0.75rem;
      color: var(--text-muted);
    }

    .chip {
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.18);
      background: rgba(9,12,31,0.9);
    }

    .progress-track {
      width: 100%;
      height: 6px;
      border-radius: 999px;
      background: rgba(255,255,255,0.08);
      overflow: hidden;
      margin-top: 4px;
    }

    .progress-fill {
      height: 100%;
      width: 0;
      border-radius: inherit;
      background: linear-gradient(90deg, var(--accent), var(--accent-strong));
      transition: width var(--transition-med);
    }

    .question-text {
      font-size: 0.92rem;
      margin-top: 4px;
    }

    .options-list {
      list-style: none;
      margin: 4px 0 0 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .option-btn {
      width: 100%;
      text-align: left;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.12);
      background: rgba(8,12,32,0.92);
      padding: 8px 10px;
      font-size: 0.85rem;
      color: var(--text-main);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      transition: background var(--transition-fast), border-color var(--transition-fast), transform var(--transition-fast), box-shadow var(--transition-fast), color var(--transition-fast);
    }

    .option-label {
      font-weight: 500;
      font-size: 0.8rem;
      opacity: 0.75;
      margin-right: 4px;
    }

    .option-text {
      flex: 1;
    }

    .option-icon {
      font-size: 1rem;
      opacity: 0;
      transform: scale(0.5);
      transition: opacity var(--transition-fast), transform var(--transition-fast);
    }

    .option-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 10px 20px rgba(0,0,0,0.55);
      border-color: rgba(76,201,240,0.6);
    }

    .option-btn.selected {
      border-color: rgba(76,201,240,0.9);
      background: radial-gradient(circle at 0 0, rgba(76,201,240,0.3), rgba(16,20,46,0.97));
    }

    .option-btn.correct {
      border-color: rgba(61,220,151,0.9);
      box-shadow: 0 0 0 1px rgba(61,220,151,0.6);
      background: radial-gradient(circle at 0 0, rgba(61,220,151,0.3), rgba(12,24,32,0.96));
    }

    .option-btn.incorrect {
      border-color: rgba(255,75,129,0.9);
      background: radial-gradient(circle at 0 0, rgba(255,75,129,0.3), rgba(24,12,24,0.96));
    }

    .option-btn.correct .option-icon,
    .option-btn.incorrect .option-icon {
      opacity: 1;
      transform: scale(1);
    }

    .feedback-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      margin-top: 4px;
      font-size: 0.8rem;
    }

    .feedback-text {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      min-height: 20px;
    }

    .feedback-text .status-dot {
      width: 9px;
      height: 9px;
      border-radius: 999px;
    }

    .feedback-text.correct .status-dot {
      background: var(--success);
      box-shadow: 0 0 8px rgba(61,220,151,0.8);
    }

    .feedback-text.incorrect .status-dot {
      background: var(--error);
      box-shadow: 0 0 8px rgba(255,75,129,0.8);
    }

    .nav-buttons {
      display: flex;
      gap: 8px;
      justify-content: flex-end;
      margin-top: 6px;
    }

    .btn {
      border-radius: var(--radius-pill);
      padding: 7px 14px;
      font-size: 0.83rem;
      border: none;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: background var(--transition-fast), transform var(--transition-fast), box-shadow var(--transition-fast), opacity var(--transition-fast);
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--accent), var(--accent-strong));
      color: #050711;
      font-weight: 600;
      box-shadow: 0 10px 25px rgba(0,0,0,0.6);
    }

    .btn-primary:disabled {
      opacity: 0.55;
      cursor: default;
      box-shadow: none;
      transform: none;
    }

    .btn-primary:not(:disabled):hover {
      transform: translateY(-1px);
      box-shadow: 0 16px 30px rgba(0,0,0,0.7);
    }

    .btn-ghost {
      background: transparent;
      border: 1px solid rgba(255,255,255,0.2);
      color: var(--text-muted);
    }

    .btn-ghost:hover {
      background: rgba(255,255,255,0.06);
      transform: translateY(-1px);
    }

    /* Result summary */

    .result-card {
      margin-top: 10px;
      border-radius: 16px;
      border: 1px solid rgba(61,220,151,0.7);
      background: radial-gradient(circle at 0 0, rgba(61,220,151,0.3), rgba(12,20,32,0.97));
      padding: 12px 13px;
      font-size: 0.85rem;
    }

    .result-header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      gap: 8px;
      flex-wrap: wrap;
      margin-bottom: 8px;
    }

    .result-header strong {
      font-size: 0.92rem;
    }

    .answer-key {
      margin-top: 6px;
      border-radius: 12px;
      background: rgba(4,9,20,0.92);
      border: 1px solid rgba(255,255,255,0.17);
      max-height: 200px;
      overflow: auto;
      padding: 8px 8px 6px;
      font-size: 0.78rem;
    }

    .answer-row {
      margin-bottom: 6px;
    }

    .answer-row span.qno {
      font-weight: 600;
      color: var(--accent);
      margin-right: 6px;
    }

    /* Footer */

    footer {
      margin-top: 16px;
      font-size: 0.75rem;
      color: var(--text-muted);
      text-align: center;
    }

    footer a {
      color: var(--accent);
      text-decoration: none;
      font-weight: 500;
    }

    footer a:hover {
      text-decoration: underline;
    }

    @media (max-width: 780px) {
      .app-shell {
        padding: 18px 14px 22px;
      }
      .quiz-main-grid.with-map {
        grid-template-columns: minmax(0, 1fr);
      }
      .quiz-map-panel {
        max-height: 180px;
      }
    }
  </style>
</head>
<body>
  <div class="app-shell">
    <header class="app-header">
      <div class="title-block">
        <h1>
          <span class="title-pill">Physics ‚Ä¢ Light</span>
          Reflection of Light
        </h1>
        <div class="subtitle">
          Gamified concept map &amp; quiz ‚Ä¢ Created by
          <span class="highlight">Rajgopal V</span> ‚Ä¢ Grade 9,
          <span class="highlight">VarshaNagar MPS</span>
        </div>
      </div>
      <div class="badge-strip">
        <div class="badge">
          <span class="dot"></span>
          Concept Map + MCQ Quiz
        </div>
        <div class="badge">
          ‚è±Ô∏è Timed practice friendly
        </div>
      </div>
    </header>

    <!-- Section navigation -->
    <nav class="section-nav" id="section-nav"></nav>

    <div class="view-toggle-row">
      <div class="view-buttons">
        <button class="view-btn active" data-view="overview">
          <span class="icon">üß†</span>
          Overview (Mental Map)
        </button>
        <button class="view-btn" data-view="quiz">
          <span class="icon">üéØ</span>
          Q &amp; A Quiz
        </button>
      </div>
      <div class="mini-info">
        Use the <span class="em">Overview</span> to explore the mental map, then test yourself in the
        <span class="em">Quiz</span>. Answers unlock after each section.
      </div>
    </div>

    <main class="content-card">
      <!-- Dynamic content goes here -->
      <div id="content"></div>
    </main>

    <footer>
      Light Reflection &amp; Mirrors ‚Ä¢ Mind-Map + Practice  
      Host this file directly on <a href="https://pages.github.com/" target="_blank" rel="noopener">GitHub Pages</a>.
    </footer>
  </div>

  <script>
    /****************************************************
     * 1. DATA: Section configuration + mental maps
     ****************************************************/

    const SECTIONS = [
      {
        id: "plane",
        title: "Plane Mirrors",
        icon: "ü™û",
        intro:
          "Plane mirrors follow simple rules: image is virtual, same size, same distance behind the mirror, and laterally inverted. Multiple reflections create many images.",
        mentalMap: `
          <div class="map-root">
            <div class="bubble"></div>
            <div>Plane Mirrors ‚Äì Basic Reflection</div>
          </div>
          <div class="map-branches">
            <div class="map-branch">
              <div class="branch-title">Image Characteristics</div>
              <div class="branch-items">
                <span class="branch-pill">Virtual &amp; erect</span>
                <span class="branch-pill">Same size as object</span>
                <span class="branch-pill">Same distance behind mirror</span>
                <span class="branch-pill">Lateral inversion</span>
              </div>
            </div>
            <div class="map-branch">
              <div class="branch-title">Multiple Reflections</div>
              <div class="branch-items">
                <span class="branch-pill">Two mirrors at angle A</span>
                <span class="branch-pill">Number of images: n = (360¬∞ / A) ‚Äì 1</span>
              </div>
            </div>
            <div class="map-branch">
              <div class="branch-title">Full-Length Image</div>
              <div class="branch-items">
                <span class="branch-pill">Mirror height = half of person‚Äôs height</span>
              </div>
            </div>
          </div>
        `
      },
      {
        id: "spherical",
        title: "Spherical Mirrors",
        icon: "üîÆ",
        intro:
          "Spherical mirrors are curved: concave (converging) and convex (diverging). Key ideas: pole, centre of curvature, principal focus, radius of curvature, and ray rules.",
        mentalMap: `
          <div class="map-root">
            <div class="bubble"></div>
            <div>Spherical Mirrors ‚Äì Types &amp; Key Terms</div>
          </div>
          <div class="map-branches">
            <div class="map-branch">
              <div class="branch-title">Types &amp; Function</div>
              <div class="branch-items">
                <span class="branch-pill">Concave ‚Äì converging, inner surface</span>
                <span class="branch-pill">Convex ‚Äì diverging, outer surface</span>
              </div>
            </div>
            <div class="map-branch">
              <div class="branch-title">Key Terminology</div>
              <div class="branch-items">
                <span class="branch-pill">Pole (P)</span>
                <span class="branch-pill">Centre of curvature (C)</span>
                <span class="branch-pill">Radius of curvature (R)</span>
                <span class="branch-pill">Principal axis</span>
                <span class="branch-pill">Principal focus (F)</span>
                <span class="branch-pill">Focal length (f = R / 2)</span>
              </div>
            </div>
            <div class="map-branch">
              <div class="branch-title">Ray Diagram Rules</div>
              <div class="branch-items">
                <span class="branch-pill">Parallel ‚Üí through F (concave)</span>
                <span class="branch-pill">Through F ‚Üí parallel</span>
                <span class="branch-pill">Through C ‚Üí returns along same path</span>
              </div>
            </div>
          </div>
        `
      },
      {
        id: "image_formation",
        title: "Image Formation",
        icon: "üñºÔ∏è",
        intro:
          "Position of object changes the position, size and nature of the image for concave and convex mirrors.",
        mentalMap: `
          <div class="map-root">
            <div class="bubble"></div>
            <div>Image Formation ‚Äì Concave &amp; Convex</div>
          </div>
          <div class="map-branches">
            <div class="map-branch">
              <div class="branch-title">Concave Mirror Images</div>
              <div class="branch-items">
                <span class="branch-pill">Object at ‚àû ‚Üí tiny real image at F</span>
                <span class="branch-pill">Beyond C ‚Üí real, inverted, diminished (between C &amp; F)</span>
                <span class="branch-pill">At C ‚Üí real, inverted, same size (at C)</span>
                <span class="branch-pill">Between C &amp; F ‚Üí real, inverted, magnified (beyond C)</span>
                <span class="branch-pill">At F ‚Üí image at ‚àû</span>
                <span class="branch-pill">Between P &amp; F ‚Üí virtual, erect, magnified (behind mirror)</span>
              </div>
            </div>
            <div class="map-branch">
              <div class="branch-title">Convex Mirror Images</div>
              <div class="branch-items">
                <span class="branch-pill">Always virtual &amp; erect</span>
                <span class="branch-pill">Always diminished</span>
                <span class="branch-pill">Always behind the mirror</span>
              </div>
            </div>
          </div>
        `
      },
      {
        id: "formulas",
        title: "Formulas & Calculations",
        icon: "üìê",
        intro:
          "Use Cartesian sign convention, mirror formula and magnification relations to solve numerical problems.",
        mentalMap: `
          <div class="map-root">
            <div class="bubble"></div>
            <div>Formulas &amp; Calculations</div>
          </div>
          <div class="map-branches">
            <div class="map-branch">
              <div class="branch-title">Sign Convention</div>
              <div class="branch-items">
                <span class="branch-pill">Object always on left of mirror</span>
                <span class="branch-pill">Distances from pole (P)</span>
                <span class="branch-pill">Right of P ‚Üí positive, left ‚Üí negative</span>
                <span class="branch-pill">Upward heights ‚Üí positive, downward ‚Üí negative</span>
                <span class="branch-pill">Concave f is negative, convex f positive</span>
              </div>
            </div>
            <div class="map-branch">
              <div class="branch-title">Mirror &amp; Magnification</div>
              <div class="branch-items">
                <span class="branch-pill">Mirror formula: 1/f = 1/v + 1/u</span>
                <span class="branch-pill">M = h‚ÇÇ / h‚ÇÅ</span>
                <span class="branch-pill">M = v / u</span>
                <span class="branch-pill">M &gt; 0 ‚Üí virtual &amp; erect</span>
                <span class="branch-pill">M &lt; 0 ‚Üí real &amp; inverted</span>
              </div>
            </div>
          </div>
        `
      },
      {
        id: "applications",
        title: "Applications",
        icon: "üí°",
        intro:
          "Different mirrors are chosen for their image properties: magnification, field of view or parallel beams.",
        mentalMap: `
          <div class="map-root">
            <div class="bubble"></div>
            <div>Applications of Mirrors</div>
          </div>
          <div class="map-branches">
            <div class="map-branch">
              <div class="branch-title">Concave Mirror Uses</div>
              <div class="branch-items">
                <span class="branch-pill">Dentists &amp; shaving mirrors (magnified image)</span>
                <span class="branch-pill">Torches &amp; vehicle headlamps (parallel beam)</span>
              </div>
            </div>
            <div class="map-branch">
              <div class="branch-title">Convex Mirror Uses</div>
              <div class="branch-items">
                <span class="branch-pill">Rear-view mirrors in vehicles</span>
                <span class="branch-pill">Security &amp; shop mirrors (wide field of view)</span>
              </div>
            </div>
          </div>
        `
      }
    ];

    /****************************************************
     * 2. DATA: Question bank
     *
     * NOTE: Only a few sample questions from each
     * section are filled in here so the code fits
     * comfortably. Add the rest of your 50 questions
     * by copying their text + answers from Excel.
     ****************************************************/

    const QUESTION_BANK = [
      /* -------- Plane Mirrors (examples) -------- */
      {
        section: "plane",
        question:
          "For a plane mirror, how does the perpendicular distance of the image from the mirror compare to the perpendicular distance of the source from the mirror?",
        answer:
          "The perpendicular distance of the image from the mirror is equal to the perpendicular distance of the source from the mirror."
      },
      {
        section: "plane",
        question:
          "What is the size of the image formed by a plane mirror relative to the size of the source?",
        answer: "The image formed by a plane mirror is of the same size as the source."
      },
      {
        section: "plane",
        question:
          "What is the phenomenon called when the image of a word appears reversed in a plane mirror?",
        answer: "This phenomenon is called lateral inversion."
      },
      {
        section: "plane",
        question:
          "What is the formula to calculate the number of images (n) formed when two plane mirrors are placed at an angle A to each other?",
        answer: "n = (360¬∞/A) ‚àí 1"
      },
      {
        section: "plane",
        question:
          "To see the full image of a person standing in front of a mirror, the minimum height of the mirror must be _____ the height of the person.",
        answer: "Half the height of the person."
      },
      {
        section: "plane",
        question: "What kind of image can be obtained on a screen?",
        answer: "A real image."
      },
      {
        section: "plane",
        question:
          "What kind of image is formed behind a mirror and cannot be obtained on a screen?",
        answer: "A virtual image."
      },

      /* -------- Spherical Mirrors (examples) -------- */
      {
        section: "spherical",
        question: "What is a spherical mirror with an inner reflecting surface called?",
        answer: "A concave mirror."
      },
      {
        section: "spherical",
        question: "What is a spherical mirror with an outer reflecting surface called?",
        answer: "A convex mirror."
      },
      {
        section: "spherical",
        question:
          "What is the term for the centre of the mirror surface in a spherical mirror?",
        answer: "The pole (P)."
      },
      {
        section: "spherical",
        question:
          "What is the term for the centre of the sphere of which the mirror is a part?",
        answer: "The centre of curvature (C)."
      },
      {
        section: "spherical",
        question:
          "What is the straight line passing through the pole and the centre of curvature of a spherical mirror called?",
        answer: "The principal axis."
      },
      {
        section: "spherical",
        question:
          "According to the relationship between focal length (f) and radius of curvature (R), how are they related in a spherical mirror?",
        answer: "The focal length is half the radius of curvature (f = R/2)."
      },
      {
        section: "spherical",
        question:
          "Rule 1 for ray diagrams: An incident ray parallel to the principal axis of a concave mirror, after reflection, passes through the ______.",
        answer: "Principal focus (F)."
      },
      {
        section: "spherical",
        question:
          "Rule 2 for ray diagrams: An incident ray passing through the principal focus of a concave mirror becomes ______ after reflection.",
        answer: "Parallel to the principal axis."
      },

      /* -------- Image Formation (examples) -------- */
      {
        section: "image_formation",
        question:
          "When an object is placed at a very large (infinite) distance from a concave mirror, where is the image formed and what is its nature?",
        answer: "A point image, real and inverted, is formed at the focus."
      },
      {
        section: "image_formation",
        question:
          "When an object is placed beyond the centre of curvature of a concave mirror, where is the image formed and what is its nature?",
        answer:
          "The image is formed between the centre of curvature and the focus, and is real, inverted and diminished."
      },
      {
        section: "image_formation",
        question:
          "When an object is placed between the pole and the focus of a concave mirror, where is the image formed and what is its nature?",
        answer: "The image is formed behind the mirror and is virtual, erect and magnified."
      },
      {
        section: "image_formation",
        question:
          "For a convex mirror, where is the image always located, and what is its nature?",
        answer:
          "The image is always behind the mirror, virtual, erect and smaller than the object."
      },

      /* -------- Formulas & Calculations (examples) -------- */
      {
        section: "formulas",
        question:
          "According to the Cartesian sign convention, on which side of the mirror is the object always placed?",
        answer: "The object is always placed on the left side of the mirror."
      },
      {
        section: "formulas",
        question:
          "According to the Cartesian sign convention, all distances parallel to the principal axis are measured from which point?",
        answer: "From the pole (P) of the mirror."
      },
      {
        section: "formulas",
        question:
          "According to the sign convention, what is the sign of the focal length of a concave mirror?",
        answer: "The focal length of a concave mirror is negative."
      },
      {
        section: "formulas",
        question:
          "According to the sign convention, what is the sign of the focal length of a convex mirror?",
        answer: "The focal length of a convex mirror is positive."
      },
      {
        section: "formulas",
        question:
          "What is the mirror formula that relates object distance (u), image distance (v) and focal length (f)?",
        answer: "1/f = 1/v + 1/u."
      },
      {
        section: "formulas",
        question:
          "What is the formula for magnification (M) in terms of the height of the image (h‚ÇÇ) and the height of the object (h‚ÇÅ)?",
        answer: "M = h‚ÇÇ / h‚ÇÅ."
      },
      {
        section: "formulas",
        question:
          "What is the formula for magnification (M) in terms of the image distance (v) and the object distance (u)?",
        answer: "M = v / u."
      },
      {
        section: "formulas",
        question:
          "If the height of an object is positive, what does a negative height for the image signify?",
        answer: "It signifies that the image is real and inverted."
      },
      {
        section: "formulas",
        question:
          "If the height of an object is positive, what does a positive height for the image signify?",
        answer: "It signifies that the image is virtual and erect."
      },

      /* -------- Applications (examples) -------- */
      {
        section: "applications",
        question:
          "Which type of mirror is used by dentists and in barber shops to get a magnified image of the face?",
        answer: "A concave mirror."
      },
      {
        section: "applications",
        question:
          "Which type of mirror is used in torches and headlamps of vehicles to obtain a parallel beam of light?",
        answer: "A concave mirror."
      },
      {
        section: "applications",
        question:
          "Which type of mirror is used as a rear-view mirror in cars and motorcycles?",
        answer: "A convex mirror."
      }

      /* üëâ Add the rest of your questions here following the same pattern.
         Use section: "plane" | "spherical" | "image_formation" | "formulas" | "applications"
         and copy the question & correct answer text from your Excel sheet. */
    ];

    /* Generic distractor pool for MCQs.
       You can customise or create specific distractors per question if you like. */
    const GENERIC_DISTRACTORS = [
      "The image is real and erect.",
      "The image is virtual and inverted.",
      "The size of the image is always smaller than the object.",
      "The size of the image is always larger than the object.",
      "The image is formed at the centre of curvature.",
      "The image is formed at the pole of the mirror.",
      "The image cannot be seen by the eye.",
      "The mirror formula does not apply.",
      "The magnification is always 1.",
      "The rays do not obey the laws of reflection."
    ];

    /****************************************************
     * 3. Utility: Build MCQ options from answer text
     ****************************************************/

    function buildOptions(correctText) {
      // Choose 3 random distractors that are not identical to the correct answer
      const pool = GENERIC_DISTRACTORS.filter(d => d !== correctText);
      const shuffled = [...pool].sort(() => Math.random() - 0.5);
      const distractors = shuffled.slice(0, 3);
      const options = [correctText, ...distractors].sort(() => Math.random() - 0.5);
      const correctIndex = options.indexOf(correctText);
      return { options, correctIndex };
    }

    /****************************************************
     * 4. State & rendering helpers
     ****************************************************/

    const state = {
      currentSectionId: SECTIONS[0].id,
      currentView: "overview", // 'overview' or 'quiz'
      quizProgress: {}, // per-section { index, score, answered: [...], completed: bool }
      mapExpanded: false
    };

    function getSection(id) {
      return SECTIONS.find(s => s.id === id);
    }

    function getQuestionsForSection(sectionId) {
      return QUESTION_BANK.filter(q => q.section === sectionId);
    }

    function initQuizState(sectionId) {
      const questions = getQuestionsForSection(sectionId);
      if (!state.quizProgress[sectionId]) {
        state.quizProgress[sectionId] = {
          index: 0,
          score: 0,
          answers: [], // { chosenIndex, correctIndex }
          completed: false
        };
      }
      // Ensure length matches number of questions (in case you add more later)
      const prog = state.quizProgress[sectionId];
      if (prog.answers.length < questions.length) {
        for (let i = prog.answers.length; i < questions.length; i++) {
          prog.answers.push(null);
        }
      }
    }

    /****************************************************
     * 5. Render section navigation and view toggles
     ****************************************************/

    function renderSectionNav() {
      const nav = document.getElementById("section-nav");
      nav.innerHTML = "";
      SECTIONS.forEach(section => {
        const btn = document.createElement("button");
        btn.className =
          "section-tab" +
          (section.id === state.currentSectionId ? " active" : "");
        btn.innerHTML = `<span class="icon">${section.icon}</span>${section.title}`;
        btn.addEventListener("click", () => {
          state.currentSectionId = section.id;
          state.mapExpanded = false;
          renderSectionNav();
          renderContent();
        });
        nav.appendChild(btn);
      });
    }

    function setupViewToggle() {
      const buttons = document.querySelectorAll(".view-btn");
      buttons.forEach(btn => {
        btn.addEventListener("click", () => {
          const view = btn.getAttribute("data-view");
          if (state.currentView !== view) {
            state.currentView = view;
            state.mapExpanded = false;
            buttons.forEach(b => b.classList.toggle("active", b === btn));
            renderContent();
          }
        });
      });
    }

    /****************************************************
     * 6. Render Overview (Mental Map)
     ****************************************************/

    function renderOverview(section) {
      const content = document.getElementById("content");
      content.innerHTML = `
        <div class="section-intro">
          <strong>${section.title}</strong><br/>
          ${section.intro}
        </div>
        <div class="mental-map">
          ${section.mentalMap}
        </div>
      `;
    }

    /****************************************************
     * 7. Render Quiz for current section
     ****************************************************/

    function renderQuiz(section) {
      const questions = getQuestionsForSection(section.id);
      initQuizState(section.id);
      const progress = state.quizProgress[section.id];
      const total = questions.length;

      // Guard: if no questions yet for this section
      if (!total) {
        document.getElementById("content").innerHTML = `
          <div class="quiz-layout">
            <div class="map-toggle-bar">
              <span class="label">
                <strong>Mental Map:</strong> ${section.title}
              </span>
              <span class="chevron">‚ñ∂</span>
            </div>
            <div class="quiz-main-grid">
              <div class="quiz-card">
                <div class="question-text">
                  No questions have been added yet for <strong>${section.title}</strong>.
                  Please update the QUESTION_BANK in the script.
                </div>
              </div>
            </div>
          </div>
        `;
        return;
      }

      const currentIndex = Math.min(progress.index, total - 1);
      const q = questions[currentIndex];

      // Build MCQ options (each render freshly ‚Äì slight randomisation each time)
      const { options, correctIndex } = buildOptions(q.answer);

      // If already answered earlier, keep the recorded choice and correct index
      const prev = progress.answers[currentIndex];
      const chosenPreviously =
        prev && typeof prev.chosenIndex === "number" ? prev.chosenIndex : null;
      const storedCorrectIndex =
        prev && typeof prev.correctIndex === "number"
          ? prev.correctIndex
          : correctIndex;

      // Save the correct index if not already stored
      if (!prev || typeof prev.correctIndex !== "number") {
        progress.answers[currentIndex] = {
          chosenIndex: chosenPreviously,
          correctIndex: storedCorrectIndex
        };
      }

      const percent = ((currentIndex + 1) / total) * 100;
      const content = document.getElementById("content");

      const withMapClass = state.mapExpanded ? "with-map" : "";
      const chevron = state.mapExpanded ? "‚ñ∂" : "‚ñ∂";

      content.innerHTML = `
        <div class="quiz-layout">
          <div class="map-toggle-bar ${state.mapExpanded ? "expanded" : ""}">
            <span class="label">
              <strong>Mental Map:</strong> ${section.title} &nbsp;‚Ä¢&nbsp;
              <span>Tap to ${state.mapExpanded ? "hide" : "open"} help</span>
            </span>
            <span class="chevron">${chevron}</span>
          </div>
          <div class="quiz-main-grid ${withMapClass}">
            ${
              state.mapExpanded
                ? `
              <aside class="quiz-map-panel">
                <div class="mental-map">
                  ${section.mentalMap}
                </div>
              </aside>
            `
                : ""
            }
            <section class="quiz-card">
              <div class="quiz-header-row">
                <div class="quiz-title">
                  ${section.title} ‚Äì Question ${currentIndex + 1} of ${total}
                  ${
                    progress.completed
                      ? `<span style="font-size:0.78rem;color:var(--accent-strong);margin-left:4px;">(Completed)</span>`
                      : ""
                  }
                </div>
                <div class="quiz-meta">
                  <span class="chip">Score: ${progress.score} / ${total}</span>
                </div>
              </div>
              <div class="progress-track">
                <div class="progress-fill" style="width:${percent}%;"></div>
              </div>
              <div class="question-text">
                ${q.question}
              </div>
              <ul class="options-list">
                ${options
                  .map(
                    (opt, idx) => `
                  <li>
                    <button
                      class="option-btn"
                      data-index="${idx}"
                    >
                      <span class="option-label">${String.fromCharCode(
                        65 + idx
                      )}.</span>
                      <span class="option-text">${opt}</span>
                      <span class="option-icon">‚òÖ</span>
                    </button>
                  </li>
                `
                  )
                  .join("")}
              </ul>
              <div class="feedback-row">
                <div class="feedback-text" id="feedback-text"></div>
                <div class="nav-buttons">
                  <button class="btn btn-ghost" id="prev-btn">
                    ‚óÄ Previous
                  </button>
                  <button class="btn btn-primary" id="next-btn" disabled>
                    ${
                      currentIndex === total - 1
                        ? progress.completed
                          ? "Restart Section"
                          : "Finish Section"
                        : "Next ‚ñ∂"
                    }
                  </button>
                </div>
              </div>
              ${
                progress.completed
                  ? renderResultSummaryHTML(section, questions, progress)
                  : ""
              }
            </section>
          </div>
        </div>
      `;

      // Add interactions
      const mapBar = document.querySelector(".map-toggle-bar");
      mapBar.addEventListener("click", () => {
        state.mapExpanded = !state.mapExpanded;
        renderQuiz(section);
      });

      const optionButtons = Array.from(
        document.querySelectorAll(".option-btn")
      );
      const feedbackEl = document.getElementById("feedback-text");
      const prevBtn = document.getElementById("prev-btn");
      const nextBtn = document.getElementById("next-btn");

      // Restore previous selection if any
      if (chosenPreviously !== null) {
        optionButtons.forEach((btn, idx) => {
          const isChosen = idx === chosenPreviously;
          const isCorrect = idx === storedCorrectIndex;

          if (isChosen && isCorrect) {
            btn.classList.add("correct");
          } else if (isChosen) {
            btn.classList.add("incorrect");
          }
        });

        const correct = chosenPreviously === storedCorrectIndex;
        feedbackEl.className = "feedback-text " + (correct ? "correct" : "incorrect");
        feedbackEl.innerHTML = `
          <span class="status-dot"></span>
          ${
            correct
              ? "Correct! üéâ"
              : "Incorrect ‚Äì check the mental map and try to understand why."
          }
        `;
        nextBtn.disabled = false;
      }

      optionButtons.forEach(btn => {
        btn.addEventListener("click", () => {
          const chosenIndex = parseInt(btn.dataset.index, 10);
          const correctIndexCurrent = storedCorrectIndex;

          // Update progress state
          const alreadyAnswered =
            progress.answers[currentIndex] &&
            typeof progress.answers[currentIndex].chosenIndex === "number";

          progress.answers[currentIndex] = {
            chosenIndex,
            correctIndex: correctIndexCurrent
          };

          // Update score only first time a question is answered
          if (!alreadyAnswered) {
            if (chosenIndex === correctIndexCurrent) progress.score += 1;
          } else {
            // If they change an answer after completion, adjust score
            // (optional; here we allow score to update)
            const wasCorrectBefore =
              progress.answers[currentIndex].chosenIndex === correctIndexCurrent;
            const nowCorrect = chosenIndex === correctIndexCurrent;
            if (!wasCorrectBefore && nowCorrect) progress.score += 1;
            if (wasCorrectBefore && !nowCorrect) progress.score -= 1;
          }

          // Update UI classes
          optionButtons.forEach(b => {
            b.classList.remove("selected", "correct", "incorrect");
          });
          btn.classList.add("selected");
          if (chosenIndex === correctIndexCurrent) {
            btn.classList.add("correct");
            feedbackEl.className = "feedback-text correct";
            feedbackEl.innerHTML = `
              <span class="status-dot"></span>
              Correct! üéâ
            `;
          } else {
            btn.classList.add("incorrect");
            feedbackEl.className = "feedback-text incorrect";
            feedbackEl.innerHTML = `
              <span class="status-dot"></span>
              Incorrect ‚Äì the correct idea is shown in the mental map.
            `;
          }

          nextBtn.disabled = false;
        });
      });

      prevBtn.addEventListener("click", () => {
        if (currentIndex > 0) {
          progress.index = currentIndex - 1;
          renderQuiz(section);
        }
      });

      nextBtn.addEventListener("click", () => {
        if (!progress.completed && currentIndex < total - 1) {
          progress.index = currentIndex + 1;
          renderQuiz(section);
        } else if (!progress.completed && currentIndex === total - 1) {
          // Mark as completed
          progress.completed = true;
          renderQuiz(section);
        } else if (progress.completed) {
          // Restart section quiz
          state.quizProgress[section.id] = {
            index: 0,
            score: 0,
            answers: new Array(total).fill(null),
            completed: false
          };
          renderQuiz(section);
        }
      });
    }

    function renderResultSummaryHTML(section, questions, progress) {
      const total = questions.length;
      const percent = ((progress.score / total) * 100).toFixed(0);

      const answerKeyHTML = questions
        .map((q, idx) => {
          const ans = q.answer;
          return `
            <div class="answer-row">
              <span class="qno">${idx + 1}.</span>
              <span class="atext">${ans}</span>
            </div>
          `;
        })
        .join("");

      return `
        <div class="result-card">
          <div class="result-header">
            <strong>${section.title} ‚Äì Section Completed ‚úÖ</strong>
            <span>Score: ${progress.score} / ${total} (${percent}%)</span>
          </div>
          <div>
            Review the correct answers below. Use the mental map to
            understand any questions you missed.
          </div>
          <div class="answer-key">
            ${answerKeyHTML}
          </div>
        </div>
      `;
    }

    /****************************************************
     * 8. Main render switch
     ****************************************************/

    function renderContent() {
      const section = getSection(state.currentSectionId);
      if (state.currentView === "overview") {
        renderOverview(section);
      } else {
        renderQuiz(section);
      }
    }

    /****************************************************
     * 9. Initialise
     ****************************************************/

    renderSectionNav();
    setupViewToggle();
    renderContent();
  </script>
</body>
</html>
